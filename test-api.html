<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test - Campaign Inventory</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-blue-400 mb-8">üîß API Test - Campaign Inventory</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-bold mb-4">Test Current Week (Aug 25-29)</h2>
                <button onclick="testCurrentWeek()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                    Test Current Week Booked Mailshots
                </button>
                <div id="currentWeekResult" class="mt-4 text-sm"></div>
            </div>
            
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-bold mb-4">Test Last Week (Aug 18-22)</h2>
                <button onclick="testLastWeek()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
                    Test Last Week Booked Mailshots
                </button>
                <div id="lastWeekResult" class="mt-4 text-sm"></div>
            </div>
        </div>
        
        <div class="bg-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">All Mailshots (No Date Filter)</h2>
            <button onclick="testAllMailshots()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
                Test All Mailshots
            </button>
            <div id="allMailshotsResult" class="mt-4 text-sm"></div>
        </div>
        
        <div class="bg-gray-800 rounded-lg p-6 mt-6">
            <h2 class="text-xl font-bold mb-4">API Status</h2>
            <div id="apiStatus" class="text-sm"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        
        async function testAPI(endpoint, description) {
            try {
                console.log(`Testing: ${description}`);
                console.log(`URL: ${API_BASE}${endpoint}`);
                
                const response = await fetch(`${API_BASE}${endpoint}`);
                const data = await response.json();
                
                console.log(`Response:`, data);
                
                return {
                    success: true,
                    data: data,
                    count: data.length
                };
            } catch (error) {
                console.error(`Error testing ${description}:`, error);
                return {
                    success: false,
                    error: error.message
                };
            }
        }
        
        async function testCurrentWeek() {
            const result = await testAPI('/inventory?start_date=2025-08-25&end_date=2025-08-29&product=Mailshot&status=Booked', 'Current Week Booked Mailshots');
            const div = document.getElementById('currentWeekResult');
            
            if (result.success) {
                div.innerHTML = `
                    <div class="text-green-400">‚úÖ Success! Found ${result.count} booked mailshots</div>
                    <div class="mt-2 text-xs">
                        ${result.data.slice(0, 3).map(item => 
                            `<div class="mb-1">‚Ä¢ ${item.brand}: ${item.booking_id} (${item.slot_date})</div>`
                        ).join('')}
                        ${result.count > 3 ? `<div class="text-gray-400">... and ${result.count - 3} more</div>` : ''}
                    </div>
                `;
            } else {
                div.innerHTML = `<div class="text-red-400">‚ùå Error: ${result.error}</div>`;
            }
        }
        
        async function testLastWeek() {
            const result = await testAPI('/inventory?start_date=2025-08-18&end_date=2025-08-22&product=Mailshot&status=Booked', 'Last Week Booked Mailshots');
            const div = document.getElementById('lastWeekResult');
            
            if (result.success) {
                div.innerHTML = `
                    <div class="text-green-400">‚úÖ Success! Found ${result.count} booked mailshots</div>
                    <div class="mt-2 text-xs">
                        ${result.data.slice(0, 3).map(item => 
                            `<div class="mb-1">‚Ä¢ ${item.brand}: ${item.booking_id} (${item.slot_date})</div>`
                        ).join('')}
                        ${result.count > 3 ? `<div class="text-gray-400">... and ${result.count - 3} more</div>` : ''}
                    </div>
                `;
            } else {
                div.innerHTML = `<div class="text-red-400">‚ùå Error: ${result.error}</div>`;
            }
        }
        
        async function testAllMailshots() {
            const result = await testAPI('/inventory?product=Mailshot', 'All Mailshots');
            const div = document.getElementById('allMailshotsResult');
            
            if (result.success) {
                const booked = result.data.filter(item => item.status === 'Booked').length;
                const available = result.data.filter(item => item.status === 'Not Booked').length;
                const onHold = result.data.filter(item => item.status === 'Hold').length;
                
                div.innerHTML = `
                    <div class="text-green-400">‚úÖ Success! Found ${result.count} total mailshots</div>
                    <div class="mt-2 text-xs">
                        <div>‚Ä¢ Booked: ${booked}</div>
                        <div>‚Ä¢ Available: ${available}</div>
                        <div>‚Ä¢ On Hold: ${onHold}</div>
                    </div>
                `;
            } else {
                div.innerHTML = `<div class="text-red-400">‚ùå Error: ${result.error}</div>`;
            }
        }
        
        async function checkAPIStatus() {
            const div = document.getElementById('apiStatus');
            try {
                const response = await fetch(`${API_BASE}/inventory`);
                if (response.ok) {
                    div.innerHTML = '<div class="text-green-400">‚úÖ API is running and responding</div>';
                } else {
                    div.innerHTML = `<div class="text-red-400">‚ùå API responded with status: ${response.status}</div>`;
                }
            } catch (error) {
                div.innerHTML = `<div class="text-red-400">‚ùå API connection failed: ${error.message}</div>`;
            }
        }
        
        // Check API status on page load
        checkAPIStatus();
    </script>
</body>
</html>
